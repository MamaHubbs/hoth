<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campground Review</title>
    <style>
        body {
            font-family: Helvetica, sans-serif; /* Helvetica for body text, fallback to sans-serif */
            line-height: 1.4;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            font-family: Arial, sans-serif; /* Arial for h1 */
            color: #133b66; /* Main color for primary heading */
            text-align: center;
            margin-bottom: 25px; /* Spacing below title, above grid content */
            font-size: 2em; /* Keep h1 at 2em */
        }
        
        /* Style for the overall rating when it's INSIDE the general info box */
        .overall-rating-general-info {
            text-align: left; /* Aligns to the left within its column */
            font-size: 1em; /* Smaller, closer to body text size */
            margin-bottom: 15px; /* Space below rating in column */
            color: #ff9800; /* Star color */
            font-weight: bold;
        }

        h2 {
            font-family: Arial, sans-serif; /* Arial for h2 */
            color: #2d7cbc; /* Secondary color for section headings */
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-top: 15px;
            font-size: 1.2em; /* All h2s are now 1.2em (smaller than 1.3em) */
        }

        h2#siteFeaturesHeading { 
            margin-top: 30px; /* Specific margin-top for Site Features H2 after Amenities */
        }
        
        p {
            margin-bottom: 10px;
        }
        strong {
            color: #555;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        ul li {
            margin-bottom: 5px;
            padding: 8px 12px;
            border-radius: 4px;
        }
        a {
            color: #2d7cbc; /* Secondary color for links */
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .rating {
            /* This style is now mainly for the individual review ratings */
            font-size: 1.2em; /* Keep individual review rating size */
            font-weight: bold;
            color: #ff9800;
        }
        /* Adjusted section-grid for 2 columns where relevant */
        .section-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        /* Style for the individual boxes within the grid */
        .section-grid > div { /* Target direct children of section-grid */
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #eee; /* This provides the outer border */
        }

        /* Styling for the nested boxes within the main left column */
        .nested-box {
            background-color: #f9f9f9; /* Same as other grid boxes */
            padding: 10px;
            border-radius: 5px;
            /* Border removed from here to prevent double border */
            margin-bottom: 15px; /* Space between nested boxes */
        }
        .nested-box:last-child {
            margin-bottom: 0; /* No margin for the last nested box */
        }


        .review-card {
            background-color: #e6f7ff;
            padding: 15px;
            border-left: 5px solid #2196f3;
            margin-top: 20px;
            border-radius: 5px;
        }
        .review-meta {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }
        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            margin-top: 20px;
            overflow: hidden;
            background-color: #000;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }


        /* Specific styles for Other Activities list items (transparent background) */
        #otherActivities ul li {
            background-color: transparent;
            padding: 0;
            margin-bottom: 0;
        }

        /* Map container styling */
        .map-container {
            overflow: hidden;
            height: 300px; /* Fixed height in pixels */
            position: relative;
            margin-top: 15px;
            border-radius: 5px;
            border: 1px solid #eee;
        }
        .map-container iframe {
            left: 0;
            top: 0;
            height: 100%;
            width: 100%;
            position: absolute;
            border: 0;
        }

        /* Styling for amenities list items to avoid extra padding from generic ul li */
        #amenitiesList li {
            background-color: transparent; /* Inherit parent background */
            padding: 0;
            margin-bottom: 5px;
        }

        /* Photo Gallery Styling */
        .photo-gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
            margin-bottom: 30px;
        }
        .photo-gallery-item {
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }
        .photo-gallery-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }
        .photo-gallery-item .caption {
            padding: 8px;
            font-size: 0.9em;
            color: #555;
            text-align: center;
            background-color: #fff;
            border-top: 1px solid #eee;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Custom style for the Favorite Sites box - NOW SELF-CONTAINED */
        .favorite-sites-box {
            border: 1px solid #2d7cbc; /* Explicit border */
            background-color: #e5f2ff; /* Explicit desired background color */
            padding: 10px; /* Explicit padding */
            margin-top: 25px; /* Spacing from Site Features */
            border-radius: 5px; /* Explicit border-radius */
            margin-left: 0; /* Explicit margin */
            margin-right: 0; /* Explicit margin */
            padding-top: 5px; /* Specific padding adjustment */
        }

        .favorite-sites-box h2 {
            margin-top: 0;
            margin-bottom: 0px; 
            border-bottom: none;
            padding-bottom: 0px; 
            line-height: 1.2; 
        }

        .favorite-sites-box p {
            margin-top: 0px; 
            margin-bottom: 0px; /* Ensure 0px for tight spacing */
        }

    </style>
</head>
<body>
    <div class="container">
        <h1 id="campgroundName">Loading Campground Review...</h1>
        
        <div class="section-grid">
            
            <div>
                
                <div class="nested-box">
                    <h2>General Info</h2>
                    <p id="overallStarRating" class="overall-rating-general-info"></p>
                    <p><strong>Website:</strong> <a id="website" href="#" target="_blank">Visit Campground Website</a></p>
                    <p><strong>Reservations:</strong> <a id="reservations" href="#" target="_blank">Click Here</a></p>
                    <p><strong>Address:</strong> <span id="address"></span></p>
                    <div class="map-container">
                        <iframe id="googleMap" frameborder="0" allowfullscreen="" aria-hidden="false" tabindex="0"></iframe>
                    </div>
                </div>
            </div>

            
            <div>
                <h2>Amenities</h2>
                <ul id="amenitiesList">
                    </ul>

                <h2 id="siteFeaturesHeading">Site Features</h2>
                <p id="siteFeatures"></p>

                <div class="favorite-sites-box"> 
                    <h2>Favorite Sites</h2>
                    <p><span id="favoriteSites"></span></p> 
                </div>
            </div>
        </div>
        <h2>Activities</h2>
        <div class="section-grid">
            <div>
                <p><strong>Waterfront:</strong> <span id="waterfront"></span></p>
                <p><strong>Hiking:</strong> <span id="hiking"></span></p>
                <p><strong>Biking:</strong> <span id="biking"></span></p>
            </div>
            <div>
                <p><strong>Other Activities:</strong> <span id="otherActivities"></span></p>
            </div>
        </div>

        <h2>Nearby Essentials</h2>
        <div class="section-grid">
            <div>
                <p><strong>Shopping Nearby:</strong> <span id="shoppingNearby"></span></p>
                <p><strong>Nearest Emergency Medical:</strong> <span id="emergencyMedicalDistance"></span></p>
            </div>
        </div>

        <h2>Photo Gallery</h2>
        <div id="photoGalleryContainer" class="photo-gallery-grid">
            <p>No photos available.</p>
        </div>

        <h2>Reviews</h2>
        <div id="reviewsContainer">
            <p>No reviews available.</p>
        </div>

    </div>

    <script src="shared.js"></script> 

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const campgroundId = getQueryParameter('campground'); 

            if (!campgroundId) {
                document.getElementById('campgroundName').textContent = "Error: Campground ID not specified in URL.";
                console.error("No 'campground' query parameter found in the URL.");
                return;
            }

            // Now, the jsonUrl points to the specific campground's JSON file in the 'campgrounds' folder
            const jsonUrl = getCampgroundJsonUrl(campgroundId); // e.g., campgrounds/pohick-bay-regional-park-06-2025.json

            fetch(jsonUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Now, 'data' IS the campground object directly, no need for data.campgrounds[0]
                    const campground = data; 

                    if (campground) {
                        // Calculate Overall Star Rating dynamically
                        let totalStars = 0;
                        let numberOfReviews = 0;

                        if (campground.reviews && campground.reviews.length > 0) {
                            campground.reviews.forEach(review => {
                                if (typeof review.starRating === 'number') { 
                                    totalStars += review.starRating;
                                    numberOfReviews++;
                                } else if (typeof review.starRating === 'string') {
                                    const parsedRating = parseInt(review.starRating);
                                    if (!isNaN(parsedRating)) {
                                        totalStars += parsedRating;
                                        numberOfReviews++;
                                    }
                                }
                            });
                        }

                        let overallAverageRating = 0;
                        if (numberOfReviews > 0) {
                            overallAverageRating = totalStars / numberOfReviews;
                        }
                        
                        // Populate Overall Rating in General Info box
                        document.getElementById('overallStarRating').textContent = "Overall Rating: " + "⭐".repeat(Math.round(overallAverageRating)) + ` (${overallAverageRating.toFixed(1)})`;

                        // General Info - Populating the box now just contains address/website/map
                        document.getElementById('campgroundName').textContent = campground.name;
                        document.getElementById('address').textContent = campground.address;
                        document.getElementById('website').href = campground.website;
                        
                        // Populate Reservations Link
                        const reservationsLink = document.getElementById('reservations');
                        if (campground.reservations) {
                            reservationsLink.href = campground.reservations;
                            reservationsLink.textContent = "Click Here";
                        } else {
                            reservationsLink.textContent = "N/A"; 
                            reservationsLink.removeAttribute('href'); 
                        }


                        // OpenStreetMap Embedding
                        const googleMapIframe = document.getElementById('googleMap'); 
                        const zoomLevel = 15; 
                        googleMapIframe.src = `https://www.openstreetmap.org/export/embed.html?bbox=${campground.longitude - 0.005},${campground.latitude - 0.002},${campground.longitude + 0.005},${campground.latitude + 0.002}&marker=${campground.latitude},${campground.longitude}&zoom=${zoomLevel}&layer=mapnik`;

                        // Favorite Sites - Now under Site Features
                        document.getElementById('favoriteSites').textContent = campground.favoriteSites.join(', ');

                        // Amenities - Dynamic Population from the new structure
                        const amenitiesList = document.getElementById('amenitiesList');
                        amenitiesList.innerHTML = ''; // Clear previous content
                        const amenities = campground.amenities;
                        if (amenities) {
                            // Order of keys for display (optional, otherwise it's insertion order or alphabetical)
                            const amenityOrder = [
                                "electric", "waterAtSite", "potableFill", "sewer", "dumpStation", "bathhouse",
                                "laundryFacilities", "cellService", "wifi", "tvCable", "petsWelcome", "dogPark",
                                "campStore", "propaneRefill", "playground", "swimmingPool", "otherAmenities"
                            ];

                            amenityOrder.forEach(key => {
                                if (amenities.hasOwnProperty(key)) {
                                    const li = document.createElement('li');
                                    let value = amenities[key];
                                    let displayKey = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());

                                    if (typeof value === 'boolean') {
                                        value = value ? "Yes" : "No";
                                    } else if (Array.isArray(value)) {
                                        value = value.join(', '); // Join array items
                                    }
                                    
                                    li.innerHTML = `<strong>${displayKey}:</strong> ${value}`;
                                    amenitiesList.appendChild(li);
                                }
                            });
                        } else {
                            amenitiesList.innerHTML = '<li>No amenities information available.</li>';
                        }
                        // END Amenities

                        // Site Features - Dynamic Population
                        document.getElementById('siteFeatures').innerHTML = ''; // Clear existing content
                        const siteFeaturesP = document.createElement('p');
                        const siteFeatures = campground.siteFeatures;
                        if (siteFeatures) {
                            const featuresArray = [];
                            // Handle 'level' as a string, others as booleans/arrays
                            if (siteFeatures.level) featuresArray.push(`<strong>Level:</strong> ${siteFeatures.level}`);
                            if (typeof siteFeatures.dirt === 'boolean') featuresArray.push(`<strong>Dirt:</strong> ${siteFeatures.dirt ? "Yes" : "No"}`);
                            else if (Array.isArray(siteFeatures.dirt)) featuresArray.push(`<strong>Dirt:</strong> ${siteFeatures.dirt.join(', ')}`);
                            else if (siteFeatures.dirt) featuresArray.push(`<strong>Dirt:</strong> ${siteFeatures.dirt}`); // If it's a string

                            if (typeof siteFeatures.gravel === 'boolean') featuresArray.push(`<strong>Gravel:</strong> ${siteFeatures.gravel ? "Yes" : "No"}`);
                            else if (Array.isArray(siteFeatures.gravel)) featuresArray.push(`<strong>Gravel:</strong> ${siteFeatures.gravel.join(', ')}`);
                            else if (siteFeatures.gravel) featuresArray.push(`<strong>Gravel:</strong> ${siteFeatures.gravel}`); // If it's a string

                            if (typeof siteFeatures.paved === 'boolean') featuresArray.push(`<strong>Paved:</strong> ${siteFeatures.paved ? "Yes" : "No"}`);
                            else if (Array.isArray(siteFeatures.paved)) featuresArray.push(`<strong>Paved:</strong> ${siteFeatures.paved.join(', ')}`);
                            else if (siteFeatures.paved) featuresArray.push(`<strong>Paved:</strong> ${siteFeatures.paved}`); // If it's a string


                            if (typeof siteFeatures.patio === 'boolean') featuresArray.push(`<strong>Patio:</strong> ${siteFeatures.patio ? "Yes" : "No"}`);
                            else if (siteFeatures.patio) featuresArray.push(`<strong>Patio:</strong> ${siteFeatures.patio}`);

                            if (typeof siteFeatures.shade === 'boolean') featuresArray.push(`<strong>Shade:</strong> ${siteFeatures.shade ? "Yes" : "No"}`);
                            else if (siteFeatures.shade) featuresArray.push(`<strong>Shade:</strong> ${siteFeatures.shade}`);

                            if (siteFeatures.fireRing) featuresArray.push(`<strong>Fire Ring:</strong> ${typeof siteFeatures.fireRing === 'boolean' ? (siteFeatures.fireRing ? "Yes" : "No") : siteFeatures.fireRing}`);
                            if (siteFeatures.picnicTable) featuresArray.push(`<strong>Picnic Table:</strong> ${typeof siteFeatures.picnicTable === 'boolean' ? (siteFeatures.picnicTable ? "Yes" : "No") : siteFeatures.picnicTable}`);
                            if (siteFeatures.grill) featuresArray.push(`<strong>Grill:</strong> ${typeof siteFeatures.grill === 'boolean' ? (siteFeatures.grill ? "Yes" : "No") : siteFeatures.grill}`);

                            if (siteFeatures.otherNotes && siteFeatures.otherNotes.length > 0) {
                                featuresArray.push(`<strong>Other Notes:</strong> ${siteFeatures.otherNotes.join(', ')}`);
                            }
                            siteFeaturesP.innerHTML = featuresArray.join('<br>'); // Join with <br> for separate lines
                            document.getElementById('siteFeatures').appendChild(siteFeaturesP);
                        } else {
                            document.getElementById('siteFeatures').textContent = 'N/A';
                        }
                        // END Site Features

                        // Activities - Dynamic Population
                        const activitiesContainer = document.getElementById('otherActivities').parentNode; // Get parent div for cleaner list styling
                        activitiesContainer.innerHTML = '<h2>Activities</h2>'; // Re-add heading
                        const activitiesListUl = document.createElement('ul');
                        activitiesListUl.style.listStyleType = 'disc';
                        activitiesListUl.style.paddingLeft = '20px';
                        const activities = campground.activities;
                        if (activities) {
                            const activityOrder = [
                                "boatingLaunch", "fishing", "hiking", "biking", "gameRoom", "otherActivities"
                            ];
                            activityOrder.forEach(key => {
                                if (activities.hasOwnProperty(key)) {
                                    const li = document.createElement('li');
                                    let value = activities[key];
                                    let displayKey = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());

                                    if (typeof value === 'boolean') {
                                        value = value ? "Yes" : "No";
                                    } else if (Array.isArray(value)) {
                                        value = value.join(', ');
                                    }
                                    li.innerHTML = `<strong>${displayKey}:</strong> ${value}`;
                                    activitiesListUl.appendChild(li);
                                }
                            });
                            activitiesContainer.appendChild(activitiesListUl);
                        } else {
                            activitiesContainer.innerHTML += '<p>No activities information available.</p>';
                        }
                        // END Activities

                        // Nearby Essentials - Dynamic Population
                        const nearbyDiv = document.getElementById('shoppingNearby').parentNode.parentNode; // Get the grid div
                        nearbyDiv.innerHTML = '<h2>Nearby Essentials</h2>'; // Re-add heading
                        const nearbyUl = document.createElement('ul');
                        nearbyUl.style.listStyleType = 'none';
                        nearbyUl.style.padding = '0';
                        const nearby = campground.nearby;
                        if (nearby) {
                            if (nearby.shopping) {
                                const li = document.createElement('li');
                                if (Array.isArray(nearby.shopping)) {
                                    li.innerHTML = `<strong>Shopping:</strong> ${nearby.shopping.join(', ')}`;
                                } else {
                                    li.innerHTML = `<strong>Shopping:</strong> ${nearby.shopping ? "Yes" : "No"}`;
                                }
                                nearbyUl.appendChild(li);
                            }
                            if (nearby.food) {
                                const li = document.createElement('li');
                                if (Array.isArray(nearby.food)) {
                                    li.innerHTML = `<strong>Food:</strong> ${nearby.food.join(', ')}`;
                                } else {
                                    li.innerHTML = `<strong>Food:</strong> ${nearby.food ? "Yes" : "No"}`;
                                }
                                nearbyUl.appendChild(li);
                            }
                            if (nearby.emergencyMedicalDistance) {
                                const li = document.createElement('li');
                                li.innerHTML = `<strong>Nearest Emergency Medical:</strong> ${nearby.emergencyMedicalDistance}`;
                                nearbyUl.appendChild(li);
                            }
                            nearbyDiv.appendChild(nearbyUl);
                        } else {
                            nearbyDiv.innerHTML += '<p>No nearby essentials information available.</p>';
                        }
                        // END Nearby Essentials

                        // Photo Gallery
                        const photoGalleryContainer = document.getElementById('photoGalleryContainer');
                        photoGalleryContainer.innerHTML = ''; 
                        if (campground.photoGallery && campground.photoGallery.length > 0) {
                            campground.photoGallery.forEach(photo => {
                                const photoItem = document.createElement('div');
                                photoItem.className = 'photo-gallery-item';
                                photoItem.innerHTML = `
                                    <img src="${photo.url}" alt="${photo.caption || 'Campground Photo'}">
                                    ${photo.caption ? `<div class="caption">${photo.caption}</div>` : ''}
                                `;
                                photoGalleryContainer.appendChild(photoItem);
                            });
                        } else {
                            photoGalleryContainer.innerHTML = '<p>No photos available for this campground.</p>';
                        }

                        // Reviews
                        const reviewsContainer = document.getElementById('reviewsContainer');
                        reviewsContainer.innerHTML = '';
                        if (campground.reviews && campground.reviews.length > 0) {
                            campground.reviews.forEach(review => {
                                const reviewCard = document.createElement('div');
                                reviewCard.className = 'review-card';
                                reviewCard.innerHTML = `
                                    <p class="review-meta">
                                        <strong>Visit Date:</strong> ${review.visitDate} | 
                                        <strong>Review Date:</strong> ${review.reviewDate} | 
                                        <strong>Rating:</strong> ${"⭐".repeat(parseInt(review.starRating))}
                                    </p>
                                    <p>${review.text}</p>
                                `;

                                if (review.youtubeVideoUrl) {
                                    const videoContainer = document.createElement('div');
                                    videoContainer.className = 'video-container';
                                    videoContainer.innerHTML = `<iframe src="${review.youtubeVideoUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>`;
                                    reviewCard.appendChild(videoContainer);
                                }
                                reviewsContainer.appendChild(reviewCard);
                            });
                        } else {
                            reviewsContainer.innerHTML = '<p>No reviews available for this campground.</p>';
                        }

                    } else {
                        document.getElementById('campgroundName').textContent = "Campground data not found or invalid.";
                    }
                })
                .catch(error => {
                    console.error('Error fetching the JSON data:', error);
                    document.getElementById('campgroundName').textContent = "Failed to load campground review.";
                });
        });
    </script>
</body>
</html>
